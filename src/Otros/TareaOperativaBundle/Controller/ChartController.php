<?phpnamespace Otros\TareaOperativaBundle\Controller;use Symfony\Bundle\FrameworkBundle\Controller\Controller;use Sensio\Bundle\FrameworkExtraBundle\Configuration\Route;use Symfony\Component\HttpFoundation\Response;/** * @Route("to/chart/") */class ChartController extends Controller{    /**     * @Route("especialista/pie/list")     */    public function listEspPieChartAction()    {        $cont = 0; $info = array(); $temp = array(); $keys = array();        // Query...        $data = $this->getDoctrine()->getManager()->getRepository('TareaOperativaBundle:TareaOperativa')->findDataChart(            '',            $this->get('session')->get('unidad_organizativa_id')        );        foreach ($data as $to)        {            foreach($to->getTareaOperativaTrabajador() as $tot)            {                $key = $tot->getTrabajador()->getArea()->getNombre();                if (array_key_exists($key, $temp))                {                    $info[$keys[$key]] = array(                        'depar' => $key,                        'total' => $temp[$key] += 1                    );                } else {                    $keys[$key] = $cont;                    $info[$keys[$key]] = array(                        'depar' => $key,                        'total' => $temp[$key] = 1                    );                    $cont++;                }            }        }        return new Response(json_encode($info));    }    /**     * @Route("especialista/bar/list")     */    public function listBarChartAction()    {        $cont = 0; $info = array(); $temp = array(); $keys = array();        // Query..        $data = $this->getDoctrine()->getManager()->getRepository('TareaOperativaBundle:TareaOperativa')->findDataChart(            '',            $this->get('session')->get('unidad_organizativa_id')        );        foreach ($data as $to)        {            $estado = $to->getDataChartBar();            foreach($to->getTareaOperativaTrabajador() as $tot)            {                $key = $tot->getTrabajador()->getArea()->getNombre();                if (in_array($key, $temp))                {                    if ($tot->getPendiente() === true)                    {                        $info[$keys[$key]]['Pendiente'] += 1;                        if ($estado['ultimodia'] === true)                        {                            $info[$keys[$key]]['Ultimo_día'] += 1;                        }                        if ($estado['fueratermino'] === true)                        {                            $info[$keys[$key]]['Fuera_termino'] += 1;                        }                    } else {                        $info[$keys[$key]]['Cumplidas'] += 1;                    }                } else {                    $keys[$key] = $cont;                    $info[$keys[$key]]['Departamento'] = $key;                    if ($tot->getPendiente() === true)                    {                        $info[$keys[$key]]['Pendiente'] = 1;                        if ($estado['ultimodia'] === true)                        {                            $info[$keys[$key]]['Ultimo_día'] = 1;                        }                        if ($estado['fueratermino'] === true)                        {                            $info[$keys[$key]]['Fuera_termino'] = 1;                        }                        $info[$keys[$key]]['Cumplidas'] = 0;                    } else {                        $info[$keys[$key]]['Pendiente'] = 0;                        $info[$keys[$key]]['Ultimo_día'] = 0;                        $info[$keys[$key]]['Fuera_termino'] = 0;                        $info[$keys[$key]]['Cumplidas'] = 1;                    }                    $cont++;                }                $temp[] = $key;            }        }        return new Response(json_encode($info));    }    /**     * @Route("responsable/pie/list")     */    public function listResPieChartAction()    {        $pend = 0; // Pendiente.        $ulti = 0; // Ultimo dia.        $fute = 0; // Fuera de termino.        $info = array();        $data = $this->getDoctrine()->getManager()->getRepository('TareaOperativaBundle:TareaOperativa')->findDataChart(            $this->get('session')->get('departamento_id'),            $this->get('session')->get('unidad_organizativa_id')        );        foreach ($data as $to)        {            $estado = $to->getDataChartBar();            $estado['pendiente'] === true ? $pend++ : null;            $estado['ultimodia'] === true ? $ulti++ : null;            $estado['fueratermino'] === true ? $fute++ : null;        }        if ($pend > 0){$info[] = array('type' => 'Pendiente', 'value' => $pend);}        if ($ulti > 0){$info[] = array('type' => 'Ultimo día', 'value' => $ulti);}        if ($fute > 0){$info[] = array('type' => 'Fuera de termino', 'value' => $fute);}        return new Response(json_encode($info));    }    /**     * @Route("responsable/bar/list")     */    public function listResBarChartAction()    {        $pend = 0; $ulti = 0; $fute = 0; $cont = 0;        $keys = array(); $info = array(); $months = array();        // Query...        $data = $this->getDoctrine()->getManager()->getRepository('TareaOperativaBundle:TareaOperativa')->findDataChart(            $this->get('session')->get('departamento_id'),            $this->get('session')->get('unidad_organizativa_id')        );        foreach ($data as $to)        {            $key = $this->get('otros.util')->str_date($to->getFechaCreacion()->format('Y-m-d'), 'm');            $val = $to->getDataChartBar();            if (in_array($key, $months))            {                if ($val['pendiente'] === true)                {                    $info[$keys[$key]]['Pendiente'] += 1;                    if ($val['ultimodia'] === true)                    {                        $info[$keys[$key]]['Ultimo_día'] += 1;                    }                    if ($val['fueratermino'] === true)                    {                        $info[$keys[$key]]['Fuera_termino'] += 1;                    }                } else {                    $info[$keys[$key]]['Cumplidas'] += 1;                }            } else {                $keys[$key] = $cont;                $info[$keys[$key]]['Mes'] = $key;                if ($val['pendiente'] === true)                {                    $info[$keys[$key]]['Pendiente'] = 1;                    if ($val['ultimodia'] === true)                    {                        $info[$keys[$key]]['Ultimo_día'] = 1;                    }                    if ($val['fueratermino'] === true)                    {                        $info[$keys[$key]]['Fuera_termino'] = 1;                    }                    $info[$keys[$key]]['Cumplidas'] = 0;                } else {                    $info[$keys[$key]]['Pendiente'] = 0;                    $info[$keys[$key]]['Ultimo_día'] = 0;                    $info[$keys[$key]]['Fuera_termino'] = 0;                    $info[$keys[$key]]['Cumplidas'] = 1;                }                $cont++;            }//            if (in_array($key, $months))//            {//                $info[$keys[$key]] = array(//                    'mes' => $key,//                    'Pendiente' => $val['pendiente'] === true ? $pend++ : $pend,//                    'Ultimo_día' => $val['ultimodia'] === true ? $ulti++ : $ulti,//                    'Fuera_termino' => $val['fueratermino'] === true ? $fute++ : $fute//                );////            } else {//                $keys[$key] = $cont;//                //--!//                $info[$keys[$key]] = array(//                    'mes' => $key,//                    'pendiente' => $val['pendiente'] === true ? 1 : 0,//                    'ultimodia' => $val['ultimodia'] === true ? 1 : 0,//                    'fueratermino' => $val['fueratermino'] === true ? 1 : 0//                );//                $cont++;//            }            $months[] = $key;        }        return new Response(json_encode($info));    }}